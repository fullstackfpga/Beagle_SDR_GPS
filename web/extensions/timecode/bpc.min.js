

/* web/extensions/timecode/bpc.min.js (web/extensions/timecode/bpc.js = Fri May 10 09:07:22 2024) */
var bpc={AMPL_NOISE_THRESHOLD:3,arm:0,data:0,data_last:0,cur:0,sec:0,msec:0,dcnt:0,line:0,prev:[],raw:[],chr:0,tod:0,time:0,dibit:['00','01','10','11'],end:null};function bpc_dmsg(s){w3_innerHTML('id-tc-bpc',s);}
function bpc_legend(){if((bpc.line&3)==0){tc_dmsg('ss hhhhhh mmmmmm ?????? dddddd mmmm yyyyyy ?? <br>');}}
function bpc_decode(b){var hour=b[1]*16+b[2]*4+b[3];if(hour<=11){var pm=b[9]&2;if(pm)hour+=12;hour=hour.leadingZeros(2);}else hour='??';var min=b[4]*16+b[5]*4+b[6];min=(min>59)?'??':min.leadingZeros(2);var sec=b[0];sec=(sec>2)?'??':(sec*20).leadingZeros(2);var day=b[10]*16+b[11]*4+b[12];day=(day==0||day>31)?'??':day.fieldWidth(2);var mo=b[13]*4+b[14];mo=(mo==0||mo>12)?'???':tc.mo[mo-1];var yr=b[15]*16+b[16]*4+b[17]+2000;var s=day+' '+mo+' '+yr+' '+hour+':'+min+':'+sec+' CST';tc_dmsg('   '+s+'<br>');tc_stat('lime','Time: '+s);}
function bpc_clr(){var b=bpc;b.data=b.data_last=0;b.cur=b.cnt=b.one_width=b.zero_width=0;b.arm=b.no_modulation=b.dcnt=b.modct=b.line=b.sec=b.msec=0;tc.trig=0;if(server_time_local!=null&&server_time_local!=''){b.time=parseInt(server_time_local)*3600+parseInt(server_time_local.substr(3))*60+60;}
b.tod=b.time;}
function bpc_ampl(ampl){var i;var b=bpc;tc.trig++;if(tc.trig>=100)tc.trig=0;ampl=(ampl>0.5)?1:0;ampl=ampl^tc.force_rev^tc.data_ainv;if(ampl==b.cur){b.cnt=0;}else{b.cnt++;if(b.cnt>b.AMPL_NOISE_THRESHOLD){b.cur=ampl;b.cnt=0;b.data_last=b.data;if(!tc.ref){b.data=ampl;tc.ref=1;}else{b.data^=1;}
if(b.data){if(tc.state!=tc.ACQ_PHASE&&tc.state!=tc.ACQ_SYNC){var t=Math.round((b.zero_width-9)/ 10);if(t>=4)t=0;b.raw[b.dcnt]=t;var s=b.dibit[t];if(t!=b.prev[b.dcnt]&&b.line){s='<span style="color:lime">'+s+'</span>';}
b.prev[b.dcnt]=t;tc_dmsg(s);if([0,3,6,9,12,14,17].includes(b.dcnt))tc_dmsg(' ');b.dcnt++;if(b.dcnt>=19){bpc_decode(b.raw);b.dcnt=0;b.line++;bpc_legend();}}
b.one_width=0;}else{b.zero_width=0;}}}
if(b.data)b.one_width++;else b.zero_width++;if(tc.state==tc.ACQ_SYNC&&b.arm==0&&b.one_width>=170){b.arm=1;b.one_width=0;}
if(b.arm==1&&b.data_last==1&&b.data==0){b.arm=2;tc.state=tc.SYNCED;tc.trig=0;tc.sample_point=40;bpc_legend();tc_stat('cyan','Found sync');}
b.msec+=10;if(b.msec==1000){b.sec++;b.msec=0;}
tc.data=b.data;}
function bpc_focus(){}
function bpc_blur(){var el;el=w3_el('id-tc-bits');if(el)el.innerHTML='';el=w3_el('id-tc-bpc');if(el)el.innerHTML='';}
function bpc_init(){w3_el('id-tc-addon').innerHTML+=w3_div('id-tc-bits')+w3_div('id-tc-bpc');}



